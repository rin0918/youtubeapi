<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>YouTube ãƒˆã‚°ãƒ«å¼æ“ä½œãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/the-new-css-reset/css/reset.min.css"
    />
    <link rel="stylesheet" href="./css/youtube.min.css" />
  </head>
  <body>
    <h1>youtube äºŒçª“ç”¨</h1>

    <div class="video-area">
      <div id="player1"></div>
      <div id="player2"></div>
    </div>

    <form>
      <input type="search" id="ytSearch" value="TRiDENT" />
      <button id="searchBtn">æ¤œç´¢</button>
    </form>

    <select class="searchlist"></select>
    <label id="video-toggle" class="toggle-button-16">
      <input type="checkbox" class="checkbox" />
      <span class="knob"></span>
      <span class="btn-bg"></span>
    </label>

    <div class="controls">
      <button id="togglePlay">
        <img src="./image/å†ç”Ÿãƒœã‚¿ãƒ³.svg" alt="" />
      </button>
      <button id="stopBtn">
        <img src="./image/å†ç”Ÿåœæ­¢ãƒœã‚¿ãƒ³.svg" alt="" />
      </button>
      <button id="muteBtn">
        <img src="./image/ãƒœãƒªãƒ¥ãƒ¼ãƒ OFFã‚¢ã‚¤ã‚³ãƒ³.svg" alt="" />
      </button>
    </div>
    <div class="control-mode">
      <button id="syncPlayBtn">åŒæ™‚å†ç”Ÿ</button>
      <button id="syncPauseBtn">åŒæ™‚ä¸€æ™‚åœæ­¢</button>
      <button id="syncStopBtn">åŒæ™‚åœæ­¢</button>
    </div>

    <!-- YouTube IFrame API èª­ã¿è¾¼ã¿ -->
    <script>
      const tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      const firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <script>
      let players = {};
      let currentPlayerId = "1";

      function onYouTubeIframeAPIReady() {
        players["1"] = new YT.Player("player1", {
          height: "360",
          width: "640",
          videoId: "bjN-3EyXNyE",
          playerVars: { playsinline: 1 },
        });

        players["2"] = new YT.Player("player2", {
          height: "360",
          width: "640",
          videoId: "We__CnrYa9U",
          playerVars: { playsinline: 1 },
        });

        setupControls();
      }

      function setupControls() {
        const togglePlayBtn = document.getElementById("togglePlay");
        const stopBtn = document.getElementById("stopBtn");
        const muteBtn = document.getElementById("muteBtn");
        const checkbox = document.querySelector(".toggle-button-16 .checkbox");
        const selectvideo = document.querySelector(".searchlist");
        const ytSearchBtn = document.querySelector("#searchBtn");

        checkbox.addEventListener("change", function () {
          currentPlayerId = checkbox.checked ? "2" : "1";

          const player1El = document.getElementById("player1");
          const player2El = document.getElementById("player2");

          if (currentPlayerId === "1") {
            player1El.classList.add("active-player");
            player2El.classList.remove("active-player");
          } else {
            player1El.classList.remove("active-player");
            player2El.classList.add("active-player");
          }

          updatePlayButtonLabel();
        });

        ytSearchBtn.addEventListener("click", function (e) {
          e.preventDefault();
          const ytSearchVal = document.querySelector("#ytSearch").value;
          ytSearch(ytSearchVal); // ğŸ” å‘¼ã³å‡ºã™ã‚ˆã†ä¿®æ­£
        });

        function ytSearch(val) {
          const key = "AIzaSyCfJGy6XoEzTZXQxVri_FxgjA-bC12Ytf8"; // â† è‡ªåˆ†ã® API ã‚­ãƒ¼ã«å¤‰æ›´ã—ã¦ãã ã•ã„
          const num = 10;
          const part = "snippet";
          const type = "video";
          const query = val;

          fetch(
            `https://www.googleapis.com/youtube/v3/search?type=${type}&part=${part}&maxResults=${num}&key=${key}&q=${query}`
          )
            .then((data) => data.json())
            .then((obj) => {
              console.log(obj); // ğŸ” ã‚³ã‚³ã§ç¢ºèª
              // ä¸€åº¦å…¨ã¦å‰Šé™¤
              selectvideo.innerHTML = "";

              for (let movie of obj["items"]) {
                const ytId = movie["id"]["videoId"];
                const ytTitle = movie["snippet"]["title"];

                const optionTag = document.createElement("option");
                optionTag.textContent = ytTitle;
                optionTag.setAttribute("value", ytId);
                selectvideo.appendChild(optionTag);
              }
            })
            .catch((err) => {
              console.error("YouTubeæ¤œç´¢ã‚¨ãƒ©ãƒ¼:", err);
            });
        }

        // ğŸ” é¸æŠã•ã‚ŒãŸå‹•ç”»ã‚’ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ­ãƒ¼ãƒ‰
        selectvideo.addEventListener("change", () => {
          const selectedVideoId = selectvideo.value;
          if (players[currentPlayerId]) {
            players[currentPlayerId].loadVideoById(selectedVideoId);
          }

          const playImg = togglePlayBtn.querySelector("img");
          playImg.src = "./image/å†ç”Ÿãƒœã‚¿ãƒ³.svg";
          playImg.alt = "å†ç”Ÿ";
          // const Img = togglePlayBtn.querySelector("img");
          // playImg.src = "./image/å†ç”Ÿãƒœã‚¿ãƒ³.svg";
          // playImg.alt = "å†ç”Ÿ";
        });

        // å†ç”Ÿãƒ»åœæ­¢ãªã©ã¯ãã®ã¾ã¾
        togglePlayBtn.addEventListener("click", () => {
          const player = players[currentPlayerId];
          if (!player) return;

          const state = player.getPlayerState();
          if (state === YT.PlayerState.PLAYING) {
            player.pauseVideo();
            playImg.src = "./image/å†ç”Ÿãƒœã‚¿ãƒ³.svg";
            playImg.alt = "å†ç”Ÿ";
          } else {
            player.playVideo();
            playImg.src = "./image/ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³.svg";
            playImg.alt = "ä¸€æ™‚åœæ­¢";
          }
        });

        stopBtn.addEventListener("click", () => {
          players[currentPlayerId]?.stopVideo();
          togglePlayBtn.innerHTML =
            '<img src="./image/å†ç”Ÿãƒœã‚¿ãƒ³.svg" alt="å†ç”Ÿ">';
        });

        muteBtn.addEventListener("click", () => {
          const player = players[currentPlayerId];
          if (!player) return;

          const muteImg = muteBtn.querySelector("img");

          if (player.isMuted()) {
            player.unMute();
            muteImg.src = "./image/ãƒœãƒªãƒ¥ãƒ¼ãƒ .svg";
            muteImg.alt = "éŸ³å£°ã‚ªãƒ³";
          } else {
            player.mute();
            muteImg.src = "./image/ãƒœãƒªãƒ¥ãƒ¼ãƒ OFFã‚¢ã‚¤ã‚³ãƒ³.svg";
            muteImg.alt = "ãƒŸãƒ¥ãƒ¼ãƒˆ";
          }
        });

        // åŒæ™‚æ“ä½œãƒœã‚¿ãƒ³
        document.getElementById("syncPlayBtn").addEventListener("click", () => {
          players["1"]?.playVideo();
          players["2"]?.playVideo();
        });

        document
          .getElementById("syncPauseBtn")
          .addEventListener("click", () => {
            players["1"]?.pauseVideo();
            players["2"]?.pauseVideo();
          });

        document.getElementById("syncStopBtn").addEventListener("click", () => {
          players["1"]?.stopVideo();
          players["2"]?.stopVideo();
          togglePlayBtn.textContent = "å†ç”Ÿ";
        });
      }

      function updatePlayButtonLabel() {
        const togglePlayBtn = document.getElementById("togglePlay");
        const player = players[currentPlayerId];
        if (!player) return;

        const state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
          togglePlayBtn.textContent = "ä¸€æ™‚åœæ­¢";
        } else {
          togglePlayBtn.textContent = "å†ç”Ÿ";
        }
      }
    </script>
  </body>
</html>
